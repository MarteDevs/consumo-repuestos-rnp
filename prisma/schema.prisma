generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model brands {
  id               Int                @id @default(autoincrement())
  name             String             @unique(map: "name") @db.VarChar(100)
  created_at       DateTime?          @default(now()) @db.Timestamp(0)
  equipment        equipment[]
  product_variants product_variants[]
}

model consumption_details {
  id                  Int                @id @default(autoincrement())
  order_id            Int
  variant_id          Int
  quantity            Decimal            @db.Decimal(10, 2)
  recorded_unit_price Decimal            @db.Decimal(10, 4)
  recorded_currency   String             @db.VarChar(3)
  total_line_cost     Decimal            @db.Decimal(12, 2)
  maintenance_orders  maintenance_orders @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "consumption_details_ibfk_1")
  product_variants    product_variants   @relation(fields: [variant_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "consumption_details_ibfk_2")

  @@index([order_id], map: "order_id")
  @@index([variant_id], map: "variant_id")
}

model equipment {
  id                  Int                  @id @default(autoincrement())
  internal_code       String               @unique(map: "internal_code") @db.VarChar(50)
  serial_number       String?              @db.VarChar(100)
  model               String?              @db.VarChar(100)
  brand_id            Int?
  current_location_id Int?
  accumulated_feet    Decimal?             @default(0.00) @db.Decimal(12, 2)
  status              String?              @default("OPERATIVO") @db.VarChar(20)
  created_at          DateTime?            @default(now()) @db.Timestamp(0)
  brands              brands?              @relation(fields: [brand_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "equipment_ibfk_1")
  locations           locations?           @relation(fields: [current_location_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "equipment_ibfk_2")
  maintenance_orders  maintenance_orders[]

  @@index([brand_id], map: "brand_id")
  @@index([current_location_id], map: "current_location_id")
  @@index([internal_code], map: "idx_equipment_code")
}

model locations {
  id                 Int                  @id @default(autoincrement())
  name               String               @db.VarChar(100)
  type               String               @db.VarChar(50)
  created_at         DateTime?            @default(now()) @db.Timestamp(0)
  equipment          equipment[]
  maintenance_orders maintenance_orders[]
}

model maintenance_orders {
  id                                                    Int                   @id @default(autoincrement())
  poot_number                                           String                @unique(map: "poot_number") @db.VarChar(50)
  order_date                                            DateTime              @default(dbgenerated("(curdate())")) @db.Date
  equipment_id                                          Int
  location_id                                           Int?
  mechanic_id                                           Int?
  supervisor_id                                         Int?
  maintenance_type                                      String?               @db.VarChar(50)
  meter_reading_previous                                Decimal?              @db.Decimal(12, 2)
  meter_reading_current                                 Decimal?              @db.Decimal(12, 2)
  exchange_rate                                         Decimal?              @default(3.800) @db.Decimal(6, 3)
  comments                                              String?               @db.Text
  created_at                                            DateTime?             @default(now()) @db.Timestamp(0)
  consumption_details                                   consumption_details[]
  equipment                                             equipment             @relation(fields: [equipment_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "maintenance_orders_ibfk_1")
  locations                                             locations?            @relation(fields: [location_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "maintenance_orders_ibfk_2")
  personnel_maintenance_orders_mechanic_idTopersonnel   personnel?            @relation("maintenance_orders_mechanic_idTopersonnel", fields: [mechanic_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "maintenance_orders_ibfk_3")
  personnel_maintenance_orders_supervisor_idTopersonnel personnel?            @relation("maintenance_orders_supervisor_idTopersonnel", fields: [supervisor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "maintenance_orders_ibfk_4")

  @@index([order_date], map: "idx_orders_date")
  @@index([equipment_id], map: "idx_orders_equipment")
  @@index([location_id], map: "location_id")
  @@index([mechanic_id], map: "mechanic_id")
  @@index([supervisor_id], map: "supervisor_id")
}

model personnel {
  id                                                             Int                  @id @default(autoincrement())
  full_name                                                      String               @db.VarChar(150)
  job_title                                                      String               @db.VarChar(50)
  is_active                                                      Boolean?             @default(true)
  created_at                                                     DateTime?            @default(now()) @db.Timestamp(0)
  maintenance_orders_maintenance_orders_mechanic_idTopersonnel   maintenance_orders[] @relation("maintenance_orders_mechanic_idTopersonnel")
  maintenance_orders_maintenance_orders_supervisor_idTopersonnel maintenance_orders[] @relation("maintenance_orders_supervisor_idTopersonnel")
}

model product_catalog {
  id               Int                @id @default(autoincrement())
  part_number      String?            @db.VarChar(50)
  name             String             @db.VarChar(200)
  unit_of_measure  String             @db.VarChar(20)
  created_at       DateTime?          @default(now()) @db.Timestamp(0)
  product_variants product_variants[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model product_variants {
  id                  Int                   @id @default(autoincrement())
  catalog_id          Int
  brand_id            Int
  unit_price          Decimal               @db.Decimal(10, 4)
  currency            String                @db.VarChar(3)
  is_active           Boolean?              @default(true)
  created_at          DateTime?             @default(now()) @db.Timestamp(0)
  consumption_details consumption_details[]
  product_catalog     product_catalog       @relation(fields: [catalog_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "product_variants_ibfk_1")
  brands              brands                @relation(fields: [brand_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "product_variants_ibfk_2")

  @@index([brand_id], map: "brand_id")
  @@index([catalog_id], map: "idx_variants_catalog")
}
